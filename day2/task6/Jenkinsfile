pipeline {
    agent any
    triggers {
        cron('*/5 * * * *')
    }
    environment {
        INSTANCE_ID = 'i-1234567890abcdef0' // This should be dynamic or passed from task 5
    }
    stages {
        stage('Take Snapshot') {
            steps {
                script {
                    echo "Taking snapshot for instance ${env.INSTANCE_ID}..."
                    // Get Volume ID from Instance ID (simplification)
                    def volumeId = sh(script: "aws ec2 describe-instances --instance-ids ${env.INSTANCE_ID} --query 'Reservations[0].Instances[0].BlockDeviceMappings[0].Ebs.VolumeId' --output text", returnStdout: true).trim()
                    
                    echo "Volume ID: ${volumeId}"
                    sh "aws ec2 create-snapshot --volume-id ${volumeId} --description 'Scheduled snapshot from Jenkins'"
                }
            }
        }
    }
}
